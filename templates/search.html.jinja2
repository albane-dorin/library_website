{% extends 'home.html.jinja2' %}

{% block link %}
    <title> BookHaven - Search for {{ query }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/search.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='/css/common.css') }}">
{% endblock %}

 {% block main %}
        <div class="content">
            <div class="result">
                <a class="return" href="javascript:window.history.back();"><img src="{{ url_for('static', filename='/img/return.png') }}"> </a>
                <div class="search-header">
                    <div class="search-title">
                        {% if quick %}
                        {{ quick }} books:
                        {% elif query=='recommendations' %}
                            {{ query[0]|upper }}{{ query[1:] }}:
                        {% else %}
                        Result for "{{ query }}":
                        {% endif %}
                    </div>
                    {% if nr!=pages %}
                    <div>Show results {{ 1+(60*(nr-1)) }}-{{ 60*nr }} over {{ total }} </div>
                    {% else %}
                        <div>Show results {{ 1+(60*(nr-1)) }}-{{ total }} over {{ total }} </div>
                    {% endif %}
                </div>
            {%  block page_top %}
            <div class="search-header-pages">
                {% if nr!=1 %}
                    <a href="{{ url_for('search', query=query, nr=(nr-1), genre=genre, date=date, grade=grade, quickSearch=quick, **({'user_id': user.id} if user else {})) }}">Previous page</a>
                {% endif %}
                {% if nr!=pages %}
                    <a href="{{ url_for('search', query=query, nr=(1+nr), genre=genre, date=date, grade=grade, quickSearch=quick, **({'user_id': user.id} if user else {})) }}">Next page</a>
                {% endif %}
            </div>
            {% endblock %}
                <div class="books_list">
                    {% for book in results %}
                        <div class="books" >
                            <img src="{{ book.img_path }}">
                            <div class="book_info">
                            <a href="{{ url_for('close_up', book_id=book.id, **({'user_id': user.id} if user else {})) }}">
                                <p title="{{ book.title }}">
                                    {% if book.title|length>30 %}
                                    {{ book.title[:30] }}...
                                    {% else %}
                                    {{ book.title }}
                                    {% endif %}
                                </p>
                                <p>{{ author[book.author_id][0] }}</p>
                            </a>
                            {% if user %}
                                <img id="more_button{{ book.id }}" src="{{ url_for('static', filename="img/more-button.png") }}" onclick="showOption({{ book.id }}, '')" class="clickable">
                                <div class="more_menu hidden" id="more_menu{{ book.id }}">
                                {% if blist[book.id] and blist[book.id].list_name != None %}
                                    <div class="menu-option" onclick="changeSave({{ user.id }}, {{ book.id }}, 'remove', 'save')">Unsave book</div>
                                {% else %}
                                    <div class="menu-option" onclick="changeSave({{ user.id }}, {{ book.id }}, 'add', 'save')">Save book</div>
                                {% endif %}
                                {% if blist[book.id] and blist[book.id].is_read %}
                                    <div class="menu-option" onclick="changeSave({{ user.id }}, {{ book.id }}, 'remove', 'read')">Unmark as read</div>
                                {% else %}
                                    <div class="menu-option" onclick="changeSave({{ user.id }}, {{ book.id }}, 'add', 'read')">Mark as read</div>
                                {% endif %}
                                </div>
                            {% endif %}
                            </div>
                            <p> {{ book.date.day }}/{{ book.date.month }}/{{ book.date.year }}</p>
                        </div>
                    {% endfor %}
                </div>
                {%  block page_bottom %}
                <div class="pages">
                    <div>
                    {% if nr!=1 %}
                        <a href="{{ url_for('search', query=query, nr=(1), genre=genre, date=date, grade=grade, quickSearch=quick, **({'user_id': user.id} if user else {})) }}" class="nr">First page</a>
                        <a href="{{ url_for('search', query=query, nr=(nr-1), genre=genre, date=date, grade=grade, quickSearch=quick, **({'user_id': user.id} if user else {})) }}" class="nr">Previous page</a>
                    {% endif %}
                    </div>

                    <div>

                    {% if pages<=9 %}
                        {% for i in range(pages) %}
                            <a href="{{ url_for('search', query=query, nr=loop.index, genre=genre, date=date, grade=grade, quickSearch=quick, **({'user_id': user.id} if user else {})) }}" class="nr {{ 'current' if loop.index == nr else '' }}">{{ loop.index }}</a>
                        {% endfor %}
                    {% elif nr<6 %}
                        {% for i in range(9) %}
                            <a href="{{ url_for('search', query=query, nr=loop.index, genre=genre, date=date, grade=grade, quickSearch=quick, **({'user_id': user.id} if user else {})) }}" class="nr {{ 'current' if loop.index == nr else '' }}">{{ loop.index }}</a>
                        {% endfor %}
                        ...
                    {% elif nr>(pages-6) %}
                        ...
                        {% for i in range(pages-8,1+pages) %}
                        <a href="{{ url_for('search', query=query, nr=pages-9+loop.index, genre=genre, date=date, grade=grade, quickSearch=quick, **({'user_id': user.id} if user else {})) }}" class="nr {{ 'current' if pages-9+loop.index == nr else '' }}">{{ pages-9+loop.index }}</a>
                        {% endfor %}
                    {% else %}
                        ...
                        {% for i in range(nr-4,5+nr) %}
                        <a href="{{ url_for('search', query=query, nr=nr-5+loop.index, genre=genre, date=date, grade=grade, quickSearch=quick, **({'user_id': user.id} if user else {})) }}" class="nr {{ 'current' if loop.index == 5 else '' }}">{{ nr-5+loop.index }}</a>
                        {% endfor %}
                        ...
                    {% endif %}
                    </div>

                    <div>
                    {% if nr!=pages %}
                        <a href="{{ url_for('search', query=query, nr=(1+nr), genre=genre, date=date, grade=grade, quickSearch=quick, **({'user_id': user.id} if user else {})) }}" class="nr">Next page</a>
                        <a href="{{ url_for('search', query=query, nr=(pages), genre=genre, date=date, grade=grade, quickSearch=quick, **({'user_id': user.id} if user else {})) }}" class="nr">Last page</a>

                    {% endif %}
                    </div>
                </div>
                {% endblock %}
            </div>
        </div>
 {% endblock %}